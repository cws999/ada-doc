<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Contracts and aspects</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 2.0em; margin-bottom: 0.6em}
    DIV.SwissExamples {font-family: Arial, Helvetica, sans-serif; font-size: 90%; line-height: 122%; margin-left: 2.2em; margin-bottom: 0.6em}
    DIV.Indented3MediumHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 6.0em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.Indented3MediumHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 2.0em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<H1 Style='font-family: "Rockwell", "Times New Roman", Times, serif; font-size: 240%'><B><SPAN Style="color:rgb(0,0,153)">Rationale Update</SPAN> for <SPAN Style="color:rgb(0,153,51)">Ada 2012</SPAN></B></H1>
<DIV Class="Normal"><FONT SIZE="+1"><I><A HREF="RCorr-TTL.html">John Barnes</A></I></FONT></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="RCorr-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-0-2.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-0-1.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-3.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>Chapter 2: Contracts and aspects</H1>
<div class="Normal">This is perhaps the most exciting area of Ada 2012 
and covers matters such as the new notation for aspects which replaces 
many uses of pragmas and also the introduction of contracts. Contracts 
include pre- and postconditions, type invariants, and subtype predicates.</div>
<div class="Normal" style="margin-bottom: 0.4em">The following Ada issues 
cover this area:</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0032-1.TXT">32</A></div><div class="Indented3MediumHanging-Body">
Questions on <SPAN Class="swiss">'Old</SPAN></div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0041-1.TXT">41</A></div><div class="Indented3MediumHanging-Body">
<SPAN Class="swiss">Type_Invariant'Class</SPAN> for interface types</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">42</A></div><div class="Indented3MediumHanging-Body">
Type invariant checking rules</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0044-1.TXT">44</A>*</div><div class="Indented3MediumHanging-Body">
Calling visible functions from type invariant expressions</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0045-1.TXT">45</A>*</div><div class="Indented3MediumHanging-Body">
Pre- and Postconditions are allowed for generic subprograms</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0049-1.TXT">49</A></div><div class="Indented3MediumHanging-Body">
Invariants need to be checked on the initialization of deferred constants</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0054-2.TXT">54</A>*</div><div class="Indented3MediumHanging-Body">
Aspect <SPAN Class="swiss">Predicate_Failure</SPAN></div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0068-1.TXT">68</A></div><div class="Indented3MediumHanging-Body">
Predicates and the current instance of a subtype</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0071-1.TXT">71</A>*</div><div class="Indented3MediumHanging-Body">
Order of evaluation when multiple predicates apply</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0077-1.TXT">77</A></div><div class="Indented3MediumHanging-Body">
<SPAN Class="swiss">Has_Same_Storage</SPAN> on objects of size zero</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0096-1.TXT">96</A></div><div class="Indented3MediumHanging-Body">
The exception raised when a subtype conversion fails a predicate check</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0099-1.TXT">99</A></div><div class="Indented3MediumHanging-Body">
Wording problems with predicates</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0104-1.TXT">104</A></div><div class="Indented3MediumHanging-Body">
Overriding an aspect is undefined</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0105-1.TXT">105</A></div><div class="Indented3MediumHanging-Body">
<SPAN Class="swiss">Pre</SPAN> and <SPAN Class="swiss">Post</SPAN> are 
not allowed on any subprogram completion</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0113-1.TXT">113</A></div><div class="Indented3MediumHanging-Body">
Class-wide preconditions and statically bound calls</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0116-1.TXT">116</A></div><div class="Indented3MediumHanging-Body">
Private types and predicates</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0131-1.TXT">131</A></div><div class="Indented3MediumHanging-Body">
Inherited <SPAN Class="swiss">Pre'Class</SPAN> when unspecified on initial 
subprogram</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0133-1.TXT">133</A></div><div class="Indented3MediumHanging-Body">
Type invariants and default initialized objects</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0149-1.TXT">149</A></div><div class="Indented3MediumHanging-Body">
Type invariants are checked for functions returning access-to-type</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0150-1.TXT">150</A></div><div class="Indented3MediumHanging-Body">
Class-wide type invariants and statically bound calls</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0154-1.TXT">154</A></div><div class="Indented3MediumHanging-Body">
Aspects of library units</div>
<div class="Normal">These changes can be grouped as follows.</div>
<div class="Normal">There are a number of clarifications on pre- and 
postconditions in general (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0045-1.TXT">45</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0105-1.TXT">105</A>), 
some additional rules on the use of the aspect <SPAN Class="swiss">Old</SPAN> 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0032-1.TXT">32</A>), 
and a trivial omission on the attribute <SPAN Class="swiss">Has_Same_Storage</SPAN> 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0077-1.TXT">77</A>).</div>
<div class="Normal">There are also clarifications regarding types and 
the use of class wide conditions and invariants (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0113-1.TXT">113</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0150-1.TXT">150</A>).</div>
<div class="Normal">A number of additional rules are required describing 
the places where type invariants are checked (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0041-1.TXT">41</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">42</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0044-1.TXT">44</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0049-1.TXT">49</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0133-1.TXT">133</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0149-1.TXT">149</A>).</div>
<div class="Normal">A new aspect <SPAN Class="swiss">Predicate_Failure</SPAN> 
and rules concerning checking order are added (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0054-2.TXT">54</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0071-1.TXT">71</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0096-1.TXT">96</A>). 
A number of clarifications to the rules for predicates are added (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0068-1.TXT">68</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0099-1.TXT">99</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0116-1.TXT">116</A>).</div>
<div class="Normal">Finally, there are minor clarifications regarding 
aspects in general (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0104-1.TXT">104</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0154-1.TXT">154</A>).</div>

<HR SIZE=1>

<div class="Normal"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0045-1.TXT">AI-45</A> 
notes that pre-and postconditions (both specific and classwide) are allowed 
on generic programs but they are not allowed on instances of generic 
subprograms. This avoids awkward maintenance problems that might arise 
if such conditions were allowed on both a generic and an instance. On 
a similar matter, it was the intent that pre- and postconditions should 
always be visible to the user and so go on specifications and not bodies 
which are completions. However, the wording forgot to mention the new 
expression functions which as well as standing alone can also be completions 
(see the example of <SPAN Class="swiss">Non_Zero</SPAN> in <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0049-1.TXT">AI-49</A> 
below). Such expression functions and null procedures acting as completions 
cannot have pre- and postconditions either (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0105-1.TXT">AI-105</A>). 
<A NAME="I1008"></A><A NAME="I1009"></A><A NAME="I1010"></A></div>
<div class="Normal">The attribute <SPAN Class="swiss">'Old</SPAN> which 
is used in a postcondition to indicate the initial value of a parameter 
(or maybe a global) is a bit tricky. <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0032-1.TXT">AI-32</A> 
adds some more (fairly obvious) detail such as that <SPAN Class="swiss">X</SPAN> 
and <SPAN Class="swiss">X'Old</SPAN> have the same type even if it is 
anonymous. <A NAME="I1011"></A><A NAME="I1012"></A></div>
<div class="Normal">A trivial point about the attribute <SPAN Class="swiss">Has_Same_Storage</SPAN> 
which is useful in preconditions is that the expression <SPAN Class="swiss">X'Has_Same_Storage(Y)</SPAN> 
returns <SPAN Class="swiss">False</SPAN> if <SPAN Class="swiss">X</SPAN> 
or <SPAN Class="swiss">Y</SPAN> or both occupy zero bits. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0077-1.TXT">AI-77</A>). 
<A NAME="I1013"></A><A NAME="I1014"></A></div>
<div class="Normal"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0131-1.TXT">AI-131</A> 
concerns <SPAN Class="swiss">Pre'Class</SPAN>. If the initial definition 
of a subprogram does not specify <SPAN Class="swiss">Pre'Class</SPAN> 
then the corresponding subprograms of derived types just inherit <SPAN Class="swiss">True</SPAN> 
as one would expect. It also notes that one cannot specify <SPAN Class="swiss">Pre'Class</SPAN> 
for an overriding subprogram of a type unless <SPAN Class="swiss">Pre'Class</SPAN> 
is specified for some ancestor. This is because it would be ored with 
<SPAN Class="swiss">True</SPAN> and thus have no effect.</div>
<div class="Normal" style="margin-bottom: 0.4em"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0113-1.TXT">AI-113</A> 
and <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0150-1.TXT">AI-150</A> 
address a problem with <SPAN Class="swiss">Pre'Class</SPAN>, <SPAN Class="swiss">Post'Class</SPAN> 
and <SPAN Class="swiss">Type_Invariant'Class</SPAN> and parameters. Typically 
we might have something like</div>
<div class="SwissExamples"><B>procedure</B>&nbsp;P(S:&nbsp;<B>in&nbsp;out</B>&nbsp;T;&nbsp;...)<BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Pre'Class&nbsp;=&gt;&nbsp;<SPAN Class="roman"><I>expression&nbsp;involving&nbsp;</I></SPAN><SPAN Class="swiss"><I>S</I></SPAN><SPAN Class="roman"><I></I></SPAN></div>
<div class="Normal">where <SPAN Class="swiss">T</SPAN> is a tagged type. 
The procedure <SPAN Class="swiss">P</SPAN> can be called with a statically 
bound parameter or indeed with a dynamically bound classwide parameter. 
The wording is clarified that the actual types of the actual parameters 
are always used. The reader is referred to the text of the Ada Issues 
which have a large example which should be helpful.</div>
<div class="Normal">It is well-known that type invariants are not intended 
to be foolproof but to be helpful in catching many flaws (unlike pre- 
and postconditions which are meant to be perfect). As time has passed 
more little quirks have been found regarding when type invariants should 
or should not be checked. Remember that invariants apply to private types. 
When we have a full view of the type (as in a subprogram in the body 
of the package declaring the type) then we can change an object of the 
type temporarily to a state where the invariant does not apply (this 
is often necessary for intermediate stages in manipulation). However, 
when we leave the full view by for example returning from a subprogram 
in the package body then checks are applied on parameters and so on. 
<A NAME="I1015"></A><A NAME="I1016"></A></div>
<div class="Normal"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0044-1.TXT">AI-44</A> 
states that type invariants are not checked on <B>in</B> parameters of 
functions but are checked on <B>in</B> parameters of procedures. This 
is necessary to avoid infinite recursion which would arise if an invariant 
itself calls a function with a parameter of the type. Moreover, a classwide 
invariant could not be used at all without this modification.</div>
<div class="Normal" style="margin-bottom: 0.4em"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0049-1.TXT">AI-49</A> 
adds that invariants need to be checked on the initialization of deferred 
constants (other initializations were already covered). An example is 
as follows</div>
<div class="SwissExamples"><B>package</B>&nbsp;R&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;T&nbsp;<B>is&nbsp;private</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Type_Invariant&nbsp;=&gt;&nbsp;Non_Zero(T);<BR>
&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;Non_Zero(X:&nbsp;T)&nbsp;<B>return</B>&nbsp;Boolean;<BR>
&nbsp;&nbsp;&nbsp;Zero:&nbsp;<B>constant</B>&nbsp;T;<BR>
<B>private</B><BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;T&nbsp;<B>is&nbsp;new</B>&nbsp;Integer;<BR>
&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;Non_Zero(X:&nbsp;T)&nbsp;<B>return</B>&nbsp;Boolean&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(X&nbsp;/=&nbsp;0);<BR>
&nbsp;&nbsp;&nbsp;Zero:&nbsp;<B>constant</B>&nbsp;T&nbsp;:=&nbsp;0;<BR>
<B>end</B>&nbsp;R;</div>
<div class="Normal">Currently, this is not caught but the declaration 
of <SPAN Class="swiss">Zero</SPAN> should raise <SPAN Class="swiss">Assertion_Error</SPAN>. 
Note the neat use of an expression function for the completion of <SPAN Class="swiss">Non_Zero</SPAN>.</div>
<div class="Normal" style="margin-bottom: 0.4em"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0133-1.TXT">AI-133</A> 
concerns default initializations and type invariants. Remember that initialization 
by default occurs in various circumstances. If a record type has components 
with an initial value as in</div>
<div class="SwissExamples"><B>type</B>&nbsp;R&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>record</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C:&nbsp;Integer&nbsp;:=&nbsp;99;<BR>
&nbsp;&nbsp;&nbsp;<B>end&nbsp;record</B>;</div>
<div class="Normal" style="margin-bottom: 0.4em">then when we declare 
an object of type <SPAN Class="swiss">R</SPAN> without any initialization 
thus</div>
<div class="SwissExamples">X:&nbsp;R;</div>
<div class="Normal">then we are assured that <SPAN Class="swiss">X.C</SPAN> 
will have the value <SPAN Class="swiss">99</SPAN>. Moreover, in Ada 2012 
we can give default values for other types by the new aspects <SPAN Class="swiss">Default_Value</SPAN> 
and <SPAN Class="swiss">Default_Component_Value</SPAN> (these are discussed 
in <A HREF="RCorr-3.html">3</A>). But we cannot give defaults for existing 
predefined types such as <SPAN Class="swiss">Integer</SPAN> since we 
can only give the default when the type is declared.</div>
<div class="Normal">The question arises as to whether or not the rule 
about default initializations being checked for the type invariant applies 
to an object declared inside the package body. Normally, of course, we 
can do what we like inside the body so we might expect such initializations 
not to be checked. However, since the default initialization mechanism 
is the same for clients outside the body as it is for the writer of the 
body, it was felt that it would be better if they were all checked for 
consistency and simplicity. An error might thus be detected earlier.</div>
<div class="Normal">But there is an exception. If the partial view of 
the type has unknown discriminants then the user cannot declare objects 
of the type anyway and so no check could be performed externally. For 
uniformity no check is performed internally either.</div>
<div class="Normal" style="margin-bottom: 0.4em"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0149-1.TXT">AI-149</A> 
adds checks for functions whose return type is an access type with a 
designated type having a part of the type concerned (parameters were 
already covered). Further similar checks are added by <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI-42</A> 
concerning type extensions. It is all a bit subtle and maybe other problems 
are lurking. One is tempted to quote a wee bonny poem of Sir Walter Scott</div>
<div class="Indented1">O what a tangled web we weave, When first we practise 
to deceive!&nbsp;</div>
<div class="Normal" style="margin-bottom: 0.4em">A more exciting change 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0041-1.TXT">AI-41</A>) 
is to allow <SPAN Class="swiss">Type_Invariant'Class</SPAN> on interface 
types. This can be used to ensure that any type derived from the interface 
satisfies certain properties. The following example is given</div>
<div class="SwissExamples"><B>type</B>&nbsp;Window&nbsp;<B>is&nbsp;interface</B><BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Type_Invariant'Class&nbsp;=&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Window.Width&nbsp;*&nbsp;Window.Height&nbsp;=&nbsp;100;</div>
<div class="SwissExamples"><B>function</B>&nbsp;Width(W:&nbsp;Window)&nbsp;<B>return</B>&nbsp;Integer&nbsp;<B>is&nbsp;abstract</B>;<BR>
<B>function</B>&nbsp;Height(W:&nbsp;Window)&nbsp;<B>return</B>&nbsp;Integer&nbsp;<B>is&nbsp;abstract</B>;</div>
<div class="Normal">This ensures that any type derived from the interface 
<SPAN Class="swiss">Window</SPAN> will provide functions giving the height 
and width of the windows such that their product is exactly 100. This 
is a display window of 100 pixels (poor quality I fear).</div>
<div class="Normal">If we derive a type from several such interfaces 
then the <SPAN Class="swiss">Type_Invariant'Class</SPAN> is of course 
the conjunction of the individual invariants.</div>
<div class="Normal">A new aspect <SPAN Class="swiss">Predicate_Failure</SPAN> 
is introduced by <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0054-2.TXT">AI-54</A> 
(with a wording correction in <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0096-1.TXT">AI-96</A>). 
A related issue concerning the order of evaluation of predicates is discussed 
in <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0071-1.TXT">AI-71</A>. 
These were discussed in detail in the <A HREF="Rat12-9-5.html">Ada 
2012 Rationale</A> and in Section 16.5 of Programming in Ada 2012. A 
short extract will suffice here. <A NAME="I1017"></A><A NAME="I1018"></A></div>
<div class="Normal" style="margin-bottom: 0.4em">The expected type of 
the expression defined by the aspect <SPAN Class="swiss">Predicate_Failure</SPAN> 
is <SPAN Class="swiss">String</SPAN> and gives the message to be associated 
with a failure. So we can write</div>
<div class="SwissExamples"><B>subtype</B>&nbsp;Open_File_Type&nbsp;<B>is</B>&nbsp;File_Type<BR>
&nbsp;&nbsp;&nbsp;<B>with</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dynamic_Predicate&nbsp;=&gt;&nbsp;Is_Open(Open_File_Type),<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Predicate_Failure&nbsp;=&gt;&nbsp;&quot;File&nbsp;not&nbsp;open&quot;;</div>
<div class="Normal">If the predicate fails then <SPAN Class="swiss">Assertion_Error</SPAN> 
is raised with the message <SPAN Class="swiss">&quot;File not open&quot;</SPAN>.</div>
<div class="Normal" style="margin-bottom: 0.4em">We can also use a raise 
expression (see <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0022-1.TXT">AI-22</A> 
in the next section) and thereby ensure that a more appropriate exception 
is raised. If we write</div>
<div class="SwissExamples">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Predicate_Failure&nbsp;=&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>raise</B>&nbsp;Status_Error&nbsp;<B>with</B>&nbsp;&quot;File&nbsp;not&nbsp;open&quot;;</div>
<div class="Normal" style="margin-bottom: 0.4em">then <SPAN Class="swiss">Status_Error</SPAN> 
is raised rather than <SPAN Class="swiss">Assertion_Error</SPAN> with 
the given message. We could of course explicitly mention <SPAN Class="swiss">Assertion_Error</SPAN> 
thus by writing</div>
<div class="SwissExamples">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Predicate_Failure&nbsp;=&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>raise</B>&nbsp;Assertion_Error&nbsp;<B>with</B>&nbsp;&quot;A&nbsp;message&quot;;</div>
<div class="Normal" style="margin-bottom: 0.4em">Finally, we could omit 
any message and just write</div>
<div class="SwissExamples">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Predicate_Failure&nbsp;=&gt;&nbsp;<B>raise</B>&nbsp;Status_Error;</div>
<div class="Normal">in which case the message is null.</div>
<div class="Normal">A related issue is discussed in <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0071-1.TXT">AI-71</A>. 
If several predicates apply to a subtype which has been declared by a 
refined sequence then the predicates are evaluated in the order in which 
they occur. This is especially important if different exceptions are 
specified by the use of <SPAN Class="swiss">Predicate_Failure</SPAN> 
since without this rule the wrong exception might be raised. The same 
applies to a combination of predicates, null exclusions and old-fashioned 
subtypes.</div>
<div class="Normal">There are a number of minor wording omissions and 
corrections with the description of predicates. <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0116-1.TXT">AI-116</A> 
notes that one cannot give a<A NAME="I1019"></A> specification of an 
aspect such as <SPAN Class="swiss">Dynamic_Predicate</SPAN> to both the 
full view and private view of a type (there is such a rule for most aspects 
but it was forgotten for predicates). A subtle point covered by <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0068-1.TXT">AI-68</A> 
is that within a predicate the current instance (such as <SPAN Class="swiss">T</SPAN> 
in the expression <SPAN Class="swiss">Non_Zero(T)</SPAN> in the example 
of <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0049-1.TXT">AI-49</A>) 
acts like a value rather than an object. (This prevents certain undesirable 
uses of <SPAN Class="swiss">T</SPAN> such as applying a number of object 
attributes.) <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0099-1.TXT">AI-99</A> 
confirms that <B>not</B> is an allowed operation in a <SPAN Class="swiss">Static_Predicate</SPAN> 
and also corrects some wording in relation to tasks and protected objects.</div>
<div class="Normal" style="margin-bottom: 0.4em">An interesting topic 
is addressed by <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0154-1.TXT">AI-154</A>. 
It may be recalled that rather than writing<A NAME="I1020"></A><A NAME="I1021"></A></div>
<div class="SwissExamples"><B>package</B>&nbsp;P&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>pragma</B>&nbsp;Pure(P);<BR>
...</div>
<div class="Normal" style="margin-bottom: 0.4em">we can instead write</div>
<div class="SwissExamples"><B>package</B>&nbsp;P<BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Pure&nbsp;<B>is</B><BR>
...</div>
<div class="Normal" style="margin-bottom: 0.4em">or more pedantically 
even</div>
<div class="SwissExamples"><B>package</B>&nbsp;P<BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Pure&nbsp;=&gt;&nbsp;True&nbsp;<B>is</B><BR>
...</div>
<div class="Normal" style="margin-bottom: 0.4em">or really foolishly</div>
<div class="SwissExamples"><B>package</B>&nbsp;P<BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Pure&nbsp;=&gt;&nbsp;False&nbsp;<B>is</B><BR>
...</div>
<div class="Normal" style="margin-bottom: 0.4em">Using a pragma rather 
than an aspect specification is the preferred style for library unit 
pragmas. But there might be some benefit in using an aspect specification 
since one could change the state of a whole group of packages in one 
blow by a structure such as</div>
<div class="SwissExamples"><B>package</B>&nbsp;State_Control&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;Purity:&nbsp;<B>constant</B>&nbsp;Boolean&nbsp;:=&nbsp;True;<BR>
&nbsp;&nbsp;&nbsp;...<BR>
<B>end</B>&nbsp;State_Control;</div>
<div class="SwissExamples">...</div>
<div class="SwissExamples"><B>with</B>&nbsp;State_Control;<BR>
<B>package</B>&nbsp;P<BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Pure&nbsp;&nbsp;=&gt;&nbsp;State_Control.Purity&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;...<BR>
<B>end</B>&nbsp;P;</div>
<div class="SwissExamples">...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>&nbsp;and&nbsp;so&nbsp;on&nbsp;for&nbsp;several&nbsp;packages</I></SPAN></div>
<div class="Normal">We could then make <SPAN Class="swiss">Purity</SPAN> 
false for adding some debugging material during development and then 
set it to true for final production.</div>
<div class="Normal" style="margin-bottom: 0.4em">Observe that <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0154-1.TXT">AI-154</A> 
illustrates that one could be silly enough to try to write</div>
<div class="SwissExamples"><B>package</B>&nbsp;P&nbsp;<B>with</B>&nbsp;Pure&nbsp;=&gt;&nbsp;Purity&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;...<BR>
&nbsp;&nbsp;&nbsp;Purity:&nbsp;<B>constant</B>&nbsp;Boolean&nbsp;:=&nbsp;True;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>illegal</I></SPAN><BR>
<B>end</B>&nbsp;P;</div>
<div class="Normal" style="margin-bottom: 0.4em">which raises the question 
of when is the wretched static expression <SPAN Class="swiss">Purity</SPAN> 
evaluated. The answer is immediately of course just like the pragma and 
so the example is illegal because <SPAN Class="swiss">Purity</SPAN> has 
not yet been elaborated. Note that aspects such as type invariants in</div>
<div class="SwissExamples"><B>type</B>&nbsp;Stack&nbsp;<B>is&nbsp;private</B><BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Type_Invariant&nbsp;=&gt;&nbsp;Is_Unduplicated(Stack);</div>
<div class="Normal">require the elaboration to be deferred. But this 
cannot be done with <SPAN Class="swiss">Pure</SPAN> because it controls 
the application of some Legality Rules.</div>
<div class="Normal">The final <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0104-1.TXT">AI-104</A> 
regarding aspects simply replaces a confusing sentence by a (confusing?) 
user note. Aspects such as <SPAN Class="swiss">Constant_Indexing</SPAN> 
can be inherited; the aspects themselves cannot be redefined but the 
functions they denote can be modified by overriding or by overloading. 
<A NAME="I1022"></A><A NAME="I1023"></A></div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="RCorr-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-0-2.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-0-1.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-3.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Class="Normal">&copy; 2016 John Barnes Informatics.</DIV>
</BODY>
</HTML>
