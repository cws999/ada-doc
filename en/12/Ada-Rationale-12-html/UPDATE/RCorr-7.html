<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Predefined library</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-bottom: 0.6em}
    DIV.SwissExamples {font-family: Arial, Helvetica, sans-serif; font-size: 90%; line-height: 122%; margin-left: 2.2em; margin-bottom: 0.6em}
    DIV.Indented3MediumHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 6.0em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.Indented3MediumHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 2.0em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<H1 Style='font-family: "Rockwell", "Times New Roman", Times, serif; font-size: 240%'><B><SPAN Style="color:rgb(0,0,153)">Rationale Update</SPAN> for <SPAN Style="color:rgb(0,153,51)">Ada 2012</SPAN></B></H1>
<DIV Class="Normal"><FONT SIZE="+1"><I><A HREF="RCorr-TTL.html">John Barnes</A></I></FONT></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="RCorr-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-0-2.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-0-1.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-6.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-8.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>Chapter 7: Predefined library</H1>
<div class="Normal">The main improvements in the standard library in 
Ada 2012 concern containers and these are addressed in the next section. 
There were also other additions such as UTF encoding packages, extensions 
to directories and the package <SPAN Class="swiss">Locales</SPAN>.</div>
<div class="Normal" style="margin-bottom: 0.4em">The following Ada Issues 
cover this area:</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0028-1.TXT">28</A>*</div><div class="Indented3MediumHanging-Body">
Import of variadic C functions</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0030-1.TXT">30</A></div><div class="Indented3MediumHanging-Body">
Formal derived types and stream attribute availability</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0031-1.TXT">31</A></div><div class="Indented3MediumHanging-Body">
<SPAN Class="swiss">All_Calls_Remote</SPAN> and indirect calls</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0034-1.TXT">34</A></div><div class="Indented3MediumHanging-Body">
Remote stream attribute calls</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0037-1.TXT">37</A>*</div><div class="Indented3MediumHanging-Body">
New types in<SPAN Class="swiss">&nbsp;Ada.Locales</SPAN> cannot be converted 
to/from strings</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0088-1.TXT">88</A></div><div class="Indented3MediumHanging-Body">
<SPAN Class="swiss">UTF_Encoding.Conversions</SPAN> and overlong characters 
on input</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0102-1.TXT">102</A></div><div class="Indented3MediumHanging-Body">
<SPAN Class="swiss">Stream_IO.File_Type</SPAN> has <SPAN Class="swiss">Preelaborable_Initialization</SPAN></div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0106-1.TXT">106</A></div><div class="Indented3MediumHanging-Body">
<SPAN Class="swiss">Write'Class</SPAN> attribute</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0121-1.TXT">121</A></div><div class="Indented3MediumHanging-Body">
Stream-oriented aspects</div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0130-1.TXT">130</A></div><div class="Indented3MediumHanging-Body">
All I/O packages should have <SPAN Class="swiss">Flush</SPAN></div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0135-1.TXT">135</A></div><div class="Indented3MediumHanging-Body">
Enumeration types should be eligible for convention <SPAN Class="swiss">C</SPAN></div>
<div class="Indented3MediumHanging-Term"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0146-1.TXT">146</A></div><div class="Indented3MediumHanging-Body">
Should say stream-oriented attribute</div>
<div class="Normal">These changes can be grouped as follows.</div>
<div class="Normal">A number of issues concern streams, their aspects 
and attributes (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0030-1.TXT">30</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0034-1.TXT">34</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0102-1.TXT">102</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0106-1.TXT">106</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0121-1.TXT">121</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0146-1.TXT">146</A>).</div>
<div class="Normal">Two issues concern interfacing to the C language 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0028-1.TXT">28</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0135-1.TXT">135</A>).</div>
<div class="Normal">Minor issues concern I/O packages and <SPAN Class="swiss">Flush</SPAN> 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0130-1.TXT">130</A>), 
the aspect <SPAN Class="swiss">All_Calls_Remote</SPAN> (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0031-1.TXT">31</A>), 
and <SPAN Class="swiss">UTF_Encoding</SPAN> (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0088-1.TXT">88</A>).</div>
<div class="Normal">Finally, there is a major revision to the new package 
<SPAN Class="swiss">Ada.Locales</SPAN> (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0037-1.TXT">37</A>).</div>

<HR SIZE=1>

<div class="Normal" style="margin-bottom: 0.4em"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0121-1.TXT">AI-121</A> 
points out that the stream-oriented attributes such as <SPAN Class="swiss">'Read</SPAN> 
and <SPAN Class="swiss">'Write</SPAN> can be given using an aspect specification 
as well as by an attribute definition clause. Thus for a type <SPAN Class="swiss">Date</SPAN> 
we can declare a procedure <SPAN Class="swiss">Date_Write</SPAN> and 
associate them using</div>
<div class="SwissExamples"><B>for</B>&nbsp;Date'Write&nbsp;<B>use</B>&nbsp;Date_Write;</div>
<div class="Normal" style="margin-bottom: 0.4em">Alternatively, we can 
declare <SPAN Class="swiss">Date</SPAN> as</div>
<div class="SwissExamples"><B>type</B>&nbsp;Date&nbsp;<B>is</B>&nbsp;<B>record</B>&nbsp;...&nbsp;<B>end&nbsp;record</B><BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Write&nbsp;=&gt;&nbsp;Date_Write,&nbsp;...&nbsp;;</div>
<div class="Normal">and then declare the procedure <SPAN Class="swiss">Date_Write</SPAN>.</div>
<div class="Normal"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0146-1.TXT">AI-146</A> 
just corrects a bit of wording; strictly we always talk about stream-oriented 
attributes and not stream attributes. <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0030-1.TXT">AI-30</A> 
clarifies the use of stream-oriented attributes with untagged formal 
derived types but ironically refers to them as stream attributes. <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0034-1.TXT">AI-34</A> 
concerns the use of streams and <SPAN Class="swiss">Remote_Types</SPAN> 
packages; in summary, dereferencing a remote access-to-classwide type 
to make a dispatching call to a stream-oriented attribute such as <SPAN Class="swiss">'Write</SPAN> 
is not allowed.</div>
<div class="Normal" style="margin-bottom: 0.4em"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0106-1.TXT">AI-106</A> 
clarifies the way in which a class wide stream-oriented aspect is given. 
For example</div>
<div class="SwissExamples"><B>type</B>&nbsp;My_Type&nbsp;<B>is&nbsp;abstract&nbsp;tagged&nbsp;null&nbsp;record</B><BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Write'Class&nbsp;=&gt;&nbsp;My_Write;</div>
<div class="Normal"><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0102-1.TXT">AI-102</A> 
adds the pragma <SPAN Class="swiss">Preelaborable_Initialization</SPAN> 
to the type <SPAN Class="swiss">File_Type</SPAN> in the package <SPAN Class="swiss">Ada.Streams.Stream_IO</SPAN>. 
It points out that the package was made preelaborable in Ada 2012 so 
that it was more useful but the corresponding change to the private type 
<SPAN Class="swiss">File_Type</SPAN> was forgotten. <A NAME="I1076"></A><A NAME="I1077"></A><A NAME="I1078"></A><A NAME="I1079"></A></div>
<div class="Normal">Two issues concern interfacing to C. <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0028-1.TXT">AI-28</A> 
discusses the import of variadic C functions (that is functions with 
a variable number of parameters). In Ada 95, it was expected that such 
functions would use the same calling conventions as normal C functions; 
however, that is not true for some targets today. Accordingly, this AI 
adds additional conventions to describe variadic C functions so that 
the Ada compiler can compile the correct calling sequence. The other 
issue (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0135-1.TXT">135</A>) 
concerns enumeration types and makes them eligible for convention <SPAN Class="swiss">C</SPAN> 
provided certain range conditions are satisfied.<A NAME="I1080"></A></div>
<div class="Normal">With regard to input-output in general <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0130-1.TXT">AI-130</A> 
adds the procedure <SPAN Class="swiss">Flush</SPAN> to the packages <SPAN Class="swiss">Sequential_IO</SPAN> 
and <SPAN Class="swiss">Direct_IO</SPAN> so that any internal buffers 
can be flushed in the same way as in <SPAN Class="swiss">Text_IO</SPAN> 
and <SPAN Class="swiss">Stream_IO</SPAN>. <A NAME="I1081"></A><A NAME="I1082"></A><A NAME="I1083"></A><A NAME="I1084"></A><A NAME="I1085"></A></div>
<div class="Normal">A rather specialized change is made by <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0031-1.TXT">AI-31</A> 
concerning the aspect <SPAN Class="swiss">All_Calls_Remote</SPAN>. It 
states that the aspect applies to all indirect or dispatching remote 
subprogram calls to the RCI (remote call interface unit) as well as to 
direct calls from outside. All indirect or dispatching calls should go 
through the PCS (partition communication subsystem). <A NAME="I1086"></A><A NAME="I1087"></A></div>
<div class="Normal">A number of packages for UTF encoding were added 
in Ada 2012. <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0088-1.TXT">AI-88</A> 
addresses a minor issue regarding overlong characters on input, that 
is as a parameter to a function <SPAN Class="swiss">Encode</SPAN> or 
<SPAN Class="swiss">Convert</SPAN>. It confirms that such overlong encodings 
do not raise <SPAN Class="swiss">Encoding_Error</SPAN>.<A NAME="I1088"></A></div>
<div class="Normal">Finally, <A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0037-1.TXT">AI-37</A> 
discusses a curious difficulty found in attempting to use the seemingly 
innocuous new package <SPAN Class="swiss">Ada.Locales</SPAN>. It was 
mentioned in the Ada 2012 Rationale which we repeat. <A NAME="I1089"></A><A NAME="I1090"></A></div>
<div class="Normal">The types <SPAN Class="swiss">Language_Code</SPAN> 
and <SPAN Class="swiss">Country_Code</SPAN> were originally declared 
as<A NAME="I1091"></A><A NAME="I1092"></A></div>
<div class="SwissExamples"><B>type</B>&nbsp;Language_Code&nbsp;<B>is&nbsp;array</B>&nbsp;(1&nbsp;..&nbsp;3)&nbsp;<B>of</B>&nbsp;Character<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>range</B>&nbsp;'a'&nbsp;..&nbsp;'z';</div>
<div class="SwissExamples"><B>type</B>&nbsp;Country_Code&nbsp;<B>is&nbsp;array</B>&nbsp;(1&nbsp;..&nbsp;2)&nbsp;<B>of</B>&nbsp;Character<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>range</B>&nbsp;'A'&nbsp;..&nbsp;'Z';</div>
<div class="Normal" style="margin-bottom: 0.4em">The problem is that 
a value of these types is not a string and cannot easily be converted 
into a string because of the range constraints and so cannot be a simple 
parameter of a subprogram such as <SPAN Class="swiss">Put</SPAN>. If 
<SPAN Class="swiss">LC</SPAN> is of type <SPAN Class="swiss">Language_Code</SPAN> 
then we have to write something tedious such as</div>
<div class="SwissExamples">Put(LC(1));&nbsp;&nbsp;Put(LC(2));&nbsp;&nbsp;Put(LC(3));</div>
<div class="Normal" style="margin-bottom: 0.4em">Accordingly, these 
types are changed so that they are derived from the type <SPAN Class="swiss">String</SPAN> 
and the constraints on the letters are then imposed by dynamic predicates. 
So we have<A NAME="I1093"></A></div>
<div class="SwissExamples"><B>type</B>&nbsp;Language_Code&nbsp;<B>is&nbsp;new</B>&nbsp;String(1&nbsp;..&nbsp;3)<BR>
&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Dynamic_Predicate&nbsp;=&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<B>for&nbsp;all</B>&nbsp;E&nbsp;<B>of</B>&nbsp;Language_Code&nbsp;=&gt;&nbsp;E&nbsp;<B>in</B>&nbsp;'a'&nbsp;..&nbsp;'z';</div>
<div class="Normal">with a similar construction for <SPAN Class="swiss">Country_Code</SPAN>.</div>
<div class="Normal">Readers might like to continue to contemplate whether 
this is an excellent illustration of some of the new features of Ada 
2012 or simply an illustration of static strong or maybe string typing 
going astray.</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="RCorr-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-0-2.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-0-1.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-6.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RCorr-8.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Class="Normal">&copy; 2016 John Barnes Informatics.</DIV>
</BODY>
</HTML>
